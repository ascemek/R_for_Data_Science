---
title: "Week 04 Exercises: Data wrangling & transformation"
author: "R for Data Science"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(tidyverse)

### may need to install this in console first!
library(nycflights13)
library(lubridate) 

# import data
chicago <- readRDS("chicago.rds")
# chicago <- read.csv("chicago.csv") # backup plan if readRDS fails
```

## Some notes on dplyr

Check out the "DataTransformationSupplement" for information on 

+ Workflow with dplyr (saving vs printing)
+ Renaming variables
+ Recoding categorical variables
+ Turning quantitative variables into categorical variables using mutate() and case_when().


#### Some trouble-shooting tips:

+ These functions assume you are working with a tidy data frame. That is, each column represents one variable, and each row represents one case.
+ You may run into issues because other packages have similarly named functions (there are several functions called `select()`, for example). If R gives you trouble about recognizing the function name, you can explicitly refer to the function within `dplyr` using `::`. For example, `dplyr::select(my_data, var1)` tells R to use the `select()` function in `dplyr`. 

## Exploration Exercises

#### EE1.

Chicago data

The data set `chicago`, which we imported in the set-up chunk, contains variables measuring air pollution and weather in Chicago. 

+ "city": the city abbreviation  
+ "tmpd": temperature (degress F)   
+ "dptp": Dewpoint   
+ "date": the date, ranging from Jan 1, 1987 to Dec 31, 2005
+ "pm25tmean2": a common pollution measure of fine particles. PM2.5 refers to the average concentration of atmospheric particulate matter that have a diameter of less than 2.5 micrometers; measured in micrograms per cubic meter
+ "pm10tmean2": another pollution measure, referring to the average concentration of atmospheric particulate matter with a diameter of less than 10 micrometers; measured in micrograms per cubic meter
+ "o3tmean2": ground level ozone (not sure of units?)
+ "no2tmean2": nitrogen dioxide (not sure of units?)

#### Part a. 

a. Suppose we want to focus on the pollution variables (pm25tmean2, pm10tmean2, o3tmean2, and no2tmean2). Show at least two ways to select only these columns in the data frame. Print out the first three rows of the new data frame.

__Hint:__ For the second way, look through the help file for `starts_with()` and `ends_with()`. These are useful, when combined with `select()`!

```{r}

```


#### Part b. 

b. The variable names are unclear and complicated. Use `rename()` to rename the following variables, and save the results in a new `chicago2` data frame. 

+ "tmpd": temp  
+ "dptp": dewpt   
+ "pm25tmean2": pm25
+ "pm10tmean2": pm10
+ "o3tmean2": ozone
+ "no2tmean2": no2

```{r}

```


#### Part c.

c. Arrange the data in descending order of pm2.5 levels, and print out the dates and pm2.5 values only for the five days with the highest pm2.5 concentration levels.

```{r}

```

#### Part d. 

d. On how many days were the pm2.5 concentration greater than 35 and the ozone level greater than 18?  (Don't print out the data set-- just the number of days in the data set where this is true)

```{r}

```

#### Part e. 

e. Create a new variable, tempC, that measures the temperature in celsius. Recall that to convert a Fahrenheit temperature to Celsius, you need to deduct 32, then multiply by 5, then divide by 9. 

Make sure you will be able to use this variable again in the future with your data, by saving the new data set as chicagoC.

```{r}

```


## EE2. 


Continue working with the chicago2 data. 

#### Part a. 

a. Install the `lubridate` package in your console if needed, then load the package. Using the `year()` and `month()` functions to create new variables showing just the year and month, respectively. 

```{r}

```


#### Part b. 

b. Use mutate() and case_when() to create a categorical variable based on temperature. Call this variable "temp_cat". Again, make sure you will be able to use this variable in the future in the chicago2 data set. 


+ hot: temp > 90
+ warm: temp > 70 and <= 90
+ cool: temp > 50 and <=70
+ cold: temp > 32 and <= 50
+ freezing: temp <= 32


__Your answer:__

```{r}

```

#### Part c. 

c. Use the data to create a scatterplot of ozone and pm2.5, with a different color for each temperature category, faceted by year. 

```{r}

```

#### Part d.

d. For how many days is the pm2.5 variable missing? On those days when pm2.5 is missing, what other variables tend to be missing as well? 

That is, if you focus only on days with no pm2.5 reading, how many of those days are also missing other variables, such as temperature, ozone, or pm10? 

Try to find a way to solve this that does not involve manually viewing the data and counting the days for each variable. 

```{r}

```


#### Part e. 

e. Reorder the variables so that year is the first column, followed by month, then date, then everything else. Drop the city variable. Then arrange the data so that it is sorted in descending order of pm2.5 first, then descending order of ozone. Print the first five rows of the resulting data set.

```{r}

```


## EE3.

Continue working with the chicago2 data.

At this point, you should have:

+ Renamed the variables to temp, dewpt, pm25, pm10, ozone, and n02. 
+ Created year and month variables using lubridate.
+ Created the temperature category variable.
+ Saved the results in a new data frame called "chicago2"

#### Part a. 

a. Verify that there are 12 months listed for each year in the data set. In other words, double check that there is not a year when, for example, November or January were excluded. 


__Your answer:__

```{r}

```

#### Part b.

b. Find the average pm2.5 count per year, for each year in the data set. It's good practice to also list the number of days each year for which the pm2.5 value was missing, and the number of days for which it was measured. 


__Your answer:__

```{r}

```


#### Part c.

c. Try to find the percent of days in each year with pm2.5 > 30. (You should have a separate percentage for each  year in the data set)

__Your answer:__

```{r}

```

#### Part d. 

d. Extra Credit Challenge: Recreate a scatterplot of pm2.5 (y) vs ozone (x), with the points on warmer days (temperature >= 80) colored red and all the other points colored grey.  Comment on what the graph shows, if anything, about how temperature is related to ozone and pm2.5. 


__Your answer:__

```{r}

```

